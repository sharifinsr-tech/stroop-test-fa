<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <title>Ø¢Ø²Ù…ÙˆÙ† Ø§Ø³ØªØ±ÙˆÙ¾</title>
    <style>
        body { font-family: Tahoma; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { max-width: 600px; width: 100%; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .page { display: none; }
        .active { display: block; }
        h1 { color: #2c3e50; text-align: center; }
        input, button { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { background: #3498db; color: white; font-weight: bold; cursor: pointer; border: none; }
        button:hover { background: #2980b9; }
        .stimulus { font-size: 80px; font-weight: bold; text-align: center; padding: 40px; margin: 30px 0; background: #f8f9fa; border-radius: 10px; }
        .buttons { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 30px 0; }
        .red-btn { background: #e74c3c; color: white; padding: 20px; font-size: 20px; border: none; border-radius: 8px; cursor: pointer; }
        .blue-btn { background: #3498db; color: white; padding: 20px; font-size: 20px; border: none; border-radius: 8px; cursor: pointer; }
        .green-btn { background: #2ecc71; color: white; padding: 20px; font-size: 20px; border: none; border-radius: 8px; cursor: pointer; }
        .stats { display: flex; justify-content: space-between; margin: 15px 0; color: #7f8c8d; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: center; }
        @media (max-width: 600px) { .buttons { grid-template-columns: 1fr; } .stimulus { font-size: 60px; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- ØµÙØ­Ù‡ Û±: ÙˆØ±ÙˆØ¯ -->
        <div id="page1" class="page active">
            <h1>ğŸ§ª Ø¢Ø²Ù…ÙˆÙ† Ø§Ø³ØªØ±ÙˆÙ¾</h1>
            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <p><strong>ğŸ“Œ ÙÙ‚Ø· Ø±Ù†Ú¯ Ù†ÙˆØ´ØªÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!</strong></p>
                <p>Ù…Ø«Ø§Ù„: <span style="color: red;">Ø¢Ø¨ÛŒ</span> â† Ø¯Ú©Ù…Ù‡ Ù‚Ø±Ù…Ø²</p>
            </div>
            <input type="text" id="studentCode" placeholder="Ú©Ø¯ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ (Ù…Ø«Ø§Ù„: 4011234567)">
            <button onclick="startTest()">ğŸš€ Ø´Ø±ÙˆØ¹ Ø¢Ø²Ù…ÙˆÙ†</button>
        </div>

        <!-- ØµÙØ­Ù‡ Û²: Ø¢Ø²Ù…ÙˆÙ† -->
        <div id="page2" class="page">
            <div class="stats">
                <span id="progress">Û°/Û°</span>
                <span id="accuracy">Û°Ùª</span>
                <span id="avgTime">Û°ms</span>
            </div>
            <div id="stimulus" class="stimulus">Ø¢Ù…Ø§Ø¯Ù‡ØŸ</div>
            <div class="buttons">
                <button class="red-btn" onclick="recordAnswer('Ù‚Ø±Ù…Ø²')">Ù‚Ø±Ù…Ø²</button>
                <button class="blue-btn" onclick="recordAnswer('Ø¢Ø¨ÛŒ')">Ø¢Ø¨ÛŒ</button>
                <button class="green-btn" onclick="recordAnswer('Ø³Ø¨Ø²')">Ø³Ø¨Ø²</button>
            </div>
            <div class="stats">
                <span id="studentCodeDisplay">Ú©Ø¯: -</span>
                <span id="timer">Û°Û°:Û°Û°</span>
            </div>
        </div>

        <!-- ØµÙØ­Ù‡ Û³: Ù†ØªØ§ÛŒØ¬ -->
        <div id="page3" class="page">
            <div class="success">
                <h2>âœ… Ø¢Ø²Ù…ÙˆÙ† Ú©Ø§Ù…Ù„ Ø´Ø¯!</h2>
                <div style="font-size: 30px; margin: 20px 0;">
                    <div id="finalAccuracy">Û°Ùª</div>
                    <small>Ø¯Ù‚Øª</small>
                </div>
                <div style="font-size: 20px;">
                    <div id="finalAvgTime">Û°ms</div>
                    <small>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù†</small>
                </div>
                <p id="saveStatus" style="margin-top: 20px; color: #28a745;">â³ Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬...</p>
            </div>
        </div>
    </div>

    <script>
        // âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸
        // ğŸ”¥ Ù„ÛŒÙ†Ú© ÙˆØ¨ Ø§Ù¾ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯!
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxRYmEgZwtfbHH93irywCs_xgV_pKPzc2evpvxZfKZVf766pPwmKzTjqcu6n435h8Pv/exec';
        // âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸

        const CONFIG = {
            words: ['Ù‚Ø±Ù…Ø²', 'Ø¢Ø¨ÛŒ', 'Ø³Ø¨Ø²'],
            colors: ['Ù‚Ø±Ù…Ø²', 'Ø¢Ø¨ÛŒ', 'Ø³Ø¨Ø²'],
            trialsPerCondition: 12,
            displayTime: 1500,
            restTime: 500
        };

        let state = {
            studentCode: '',
            trials: [],
            currentTrial: 0,
            startTime: 0,
            results: [],
            testStartTime: 0,
            timerInterval: null
        };

        // Ø´Ø±ÙˆØ¹ Ø¢Ø²Ù…ÙˆÙ†
        function startTest() {
            const code = document.getElementById('studentCode').value.trim();
            if (!code) return alert('Ú©Ø¯ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
            
            state.studentCode = code;
            document.getElementById('studentCodeDisplay').innerHTML = `Ú©Ø¯: ${code}`;
            
            // ØªÙˆÙ„ÛŒØ¯ Ø¢Ø²Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§
            state.trials = [];
            for (let i = 0; i < CONFIG.trialsPerCondition; i++) {
                CONFIG.words.forEach(w => state.trials.push({ type: 'Ù‡Ù…Ø®ÙˆØ§Ù†', word: w, color: w }));
                CONFIG.words.forEach(w => {
                    const other = CONFIG.colors.filter(c => c !== w);
                    state.trials.push({ type: 'Ù†Ø§Ù‡Ù…Ø®ÙˆØ§Ù†', word: w, color: other[Math.floor(Math.random() * other.length)] });
                });
            }
            state.trials.sort(() => Math.random() - 0.5);
            
            state.testStartTime = Date.now();
            startTimer();
            switchPage('page2');
            setTimeout(runTrial, 500);
        }

        // Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ø²Ù…Ø§ÛŒØ´
        function runTrial() {
            if (state.currentTrial >= state.trials.length) return finishTest();
            
            const trial = state.trials[state.currentTrial];
            const el = document.getElementById('stimulus');
            el.textContent = trial.word;
            el.style.color = trial.color === 'Ù‚Ø±Ù…Ø²' ? '#e74c3c' : trial.color === 'Ø¢Ø¨ÛŒ' ? '#3498db' : '#2ecc71';
            
            document.getElementById('progress').textContent = `${state.currentTrial + 1}/${state.trials.length}`;
            state.startTime = Date.now();
        }

        // Ø«Ø¨Øª Ù¾Ø§Ø³Ø®
        function recordAnswer(color) {
            const rt = Date.now() - state.startTime;
            const trial = state.trials[state.currentTrial];
            
            state.results.push({
                trialNumber: state.currentTrial + 1,
                type: trial.type,
                word: trial.word,
                correctColor: trial.color,
                userResponse: color,
                reactionTime: rt,
                isCorrect: color === trial.color ? 1 : 0
            });
            
            // Ø¢Ù…Ø§Ø± Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ
            const avg = state.results.reduce((s, r) => s + r.reactionTime, 0) / state.results.length;
            const correct = state.results.filter(r => r.isCorrect === 1).length;
            const acc = (correct / state.results.length * 100);
            
            document.getElementById('avgTime').textContent = `${Math.round(avg)}ms`;
            document.getElementById('accuracy').textContent = `${Math.round(acc)}%`;
            
            document.getElementById('stimulus').textContent = '';
            state.currentTrial++;
            
            if (state.currentTrial < state.trials.length) {
                setTimeout(runTrial, CONFIG.restTime);
            } else {
                finishTest();
            }
        }

        // Ù¾Ø§ÛŒØ§Ù† Ø¢Ø²Ù…ÙˆÙ† Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø´ÛŒØª
        function finishTest() {
            clearInterval(state.timerInterval);
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ
            const total = state.results.length;
            const correct = state.results.filter(r => r.isCorrect === 1).length;
            const accuracy = Math.round((correct / total) * 100);
            const avgTime = Math.round(state.results.reduce((s, r) => s + r.reactionTime, 0) / total);
            
            document.getElementById('finalAccuracy').textContent = `${accuracy}%`;
            document.getElementById('finalAvgTime').textContent = `${avgTime}ms`;
            
            // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Google Sheets
            fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    studentCode: state.studentCode,
                    results: state.results
                })
            }).catch(err => console.log('Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ (no-cors)'));
            
            document.getElementById('saveStatus').innerHTML = 'âœ… Ù†ØªØ§ÛŒØ¬ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø± Google Sheets Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!';
            switchPage('page3');
        }

        // ØªØ§ÛŒÙ…Ø±
        function startTimer() {
            clearInterval(state.timerInterval);
            state.timerInterval = setInterval(() => {
                const e = Date.now() - state.testStartTime;
                const m = Math.floor(e / 60000);
                const s = Math.floor((e % 60000) / 1000);
                document.getElementById('timer').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            }, 1000);
        }

        // ØªØºÛŒÛŒØ± ØµÙØ­Ù‡
        function switchPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // Ø§ÛŒÙ†ØªØ± Ø¯Ø± ÙÛŒÙ„Ø¯ Ú©Ø¯ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('studentCode').focus();
            document.getElementById('studentCode').addEventListener('keypress', e => {
                if (e.key === 'Enter') startTest();
            });
        });
    </script>
</body>
</html>
